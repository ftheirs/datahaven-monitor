name: Stress Test â€“ File Upload

on:
  workflow_dispatch:
    inputs:
      network:
        description: 'Network to test'
        required: true
        default: 'stagenet'
        type: choice
        options:
          - stagenet
          - testnet

permissions:
  contents: read

jobs:
  stress-upload:
    name: File Upload Stress Test
    runs-on: ubuntu-latest
    timeout-minutes: 45

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: latest

      - name: Install dependencies
        run: bun install

      - name: Run file upload stress test
        env:
          ACCOUNT_PRIVATE_KEY: ${{ secrets.ACCOUNT_PRIVATE_KEY }}
          DATAHAVEN_NETWORK: ${{ inputs.network }}
        run: bun run stress:upload

      - name: Upload results (on failure)
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: stress-test-logs-${{ inputs.network }}-${{ github.run_number }}
          path: |
            *.log
          retention-days: 7

